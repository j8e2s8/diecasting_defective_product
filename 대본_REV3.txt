안녕하세요 yoyoyoyoyo 조에서 발표를 맡게된 장일준입니다.
금형 양산 공정을 어떻게 개선할지 데이터 분석한 것을 발표하겠습니다.

저희 회사는 금형으로 알류미늄 제품을 생산하는 다이캐스팅 회사입니다.
최근 TM Carrier RH라는 제품 양산을 시작했는데요.
요번에 제품을 생산하다가 생긴 이슈를 소개해드리려고 가져왔습니다.

(양산 일수 별 불량률 그래프)
양산한지 하루하루가 지나감에 따른 불량률 변화 그래프입니다.
2월 15일 이후로 불량률이 확 떨어졌죠? 이 때 저희가 새로운시스템을 도입했습니다.(이것이 우리의 컨셉!)
시스템을 도입하고 5주동안 지켜보니, 확실히 불량률이 떨어지더라구요.
여기서 우리는 의문점이 생겼습니다.

<-----------------
은서)
불량률이 떨어져서 환경이 바뀌어보임 [5페이지] ->PSI를 확인해봄 [6페이지] -> 많은 변수들의 분포가 바뀜 (양산하는 환경 바뀐걸 확인) [7페이지] 
-> "양산하는 환경이 바뀌었는데 바뀌기 전 데이터만 학습한 모델의 솔루션을 그대로 가져가는게 맞는가?"
-> 이 전의 모델을 그대로 사용한다. 시스템 도입 후 데이터만 학습한 모델을 사용한다. 전체 기간 데이터를 학습하는게 맞다. 의견이 분분. [8페이지] 
-> 즉, "불량과 정상품의 패턴을 파악함에 있어서 어떤 데이터를 선택하는 것이 좋냐"를 찾는 것이 저희의 주제입니다.
<--------------------

"양산하는 환경이 바뀌었는데 바뀌기 전 데이터만 학습한 모델의 솔루션을 그대로 가져가는게 맞는가?"
이 전의 모델을 그대로 사용한다. 시스템 도입 후 데이터만 학습한 모델을 사용한다. 전체 기간 데이터를 학습하는게 맞다. 의견이 분분했습니다.(그림 손으로 가리키면서 말하기)

시스템 도입 전, 후 데이터들의 분포 차이를 확인했습니다.
PSI값이 0.25보다 높으면 분포가 상당히 변한 것입니다.
시스템 도입 전후가 확실히 다릅니다.
즉, "불량과 정상품의 패턴을 파악함에 있어서 어떤 데이터를 선택하는 것이 좋냐"를 찾는 것이 저희의 주제입니다.

[데이터 소개, eda, 피처 엔지니어링]
데이터 소개입니다.
다이캐스팅 금형을 통해 제품 생산을 할 때 작성된 데이터입니다.
여러가지 변수들과 제품이 정상이었는지, 불량이었는지 기록되어 있습니다.

(describe, info 확인)
기초 통계량, 데이터 타입 및 결측치 갯수를 확인했습니다.
타겟변수 결측치가 하나 있습니다. 이 행이 유독 결측치가 많아서 제거했습니다.

(유니크값 확인)
변수가 가지고 있는 값의 종류를 확인했습니다. mold_code라는 변수는 금형하나하나를 칭하는 변수라고 판단했습니다.
('count'변수와 각 mold_code의 계단식 그래프 보여주기) 즉 같은 제품을 생산하는 금형이 7가지인 것이지요.
범주형 타입으로 바꾸었습니다.

registration_time은 시간 데이터로, 저희의 타겟 변수는 참과 거짓으로만 이뤄진 불리언 타입으로 바꿨습니다.

(타겟변수 빈도그래프)
먼저 타겟변수의 정상과 불량의 갯수입니다. 0이 정상, 1이 불량품입니다.
데이터가 불균형하기 때문에 이후 샘플링 기법을 고려하기로 했습니다.

(확률밀도분포)
(범주 빈도 그래프)
(박스플롯)
(산점도)
(라인플롯)
(기본적인 의사결정나무)

(시간 파생변수 추가)
월, 일, 시, 분, 초 파생변수를 추가해서 넣었습니다. 분류 성능이 좋아지더라구요.
양산 일수 변수를 추가했습니다. 1월2일은 1, 1월 3일은 2... 이렇게 몇 번째 날인지 표시했습니다.

(시간별 ?? 변수의 값 변화량 그래프 보여주기)
특별한 시간 변수를 추가했습니다. 7시, 8시, 19시, 20시에 값이 특이하게 변화하더라구요.

유니크한 값이 하나인 변수 제거했습니다.
역할이 중복되는 시간관련 변수들도 제거했습니다.
'upper_mold_temp3', 'lower_mold_temp3' 변수는 데이터가 이상하다고 판단하여 제거했습니다.(근거 보여주기)

분류에 상관없다고 판단한 'count', 'heating_furnace' 두가지 변수도 제거했습니다.

(Try Shot Signal 빈도그래프만 보여주기)
이 전에 Try Shot Signal 변수가 D값일 때, 불량률이 100%라는 것을 확인했습니다.

Try Shot 사탕의 개념을 짚고 넘어가겠습니다.
다이캐스팅 금형에는 쇳물이 들어갑니다. 쇳물은 유동성이 좋지 않습니다. 유동성은 흐르는 성질입니다. 특히 온도가 낮을 때는 유동성이 더 안 좋습니다.
이 상태에서 생산을 하면 완전한 제품이 나오지 않습니다.
양산시에 금형 온도가 높아야됩니다. 금형 온도를 높이기 위해서 양산 전 금형에 쇳물을 주입합니다.
정상 제품을 만들기 위해서가 아닌, 금형 온도를 높이기 위해 쇳물 주입하는 것을 사탕이라고 합니다.
즉, Try Shot Signal 변수가 D값일 때는 양산 중인 상태가 아닙니다.
저희의 목표는 양산 중 공정 개선을 하는 것이므로 이 데이터를 사용하지 않고 분석하기로 했습니다.

모델을 만들기 전 피쳐엔지니어링을 진행했습니다. 파생변수를 넣고 뺌에 있어서, 각 모델에서 점수가 잘 나오면 넣었습니다.
그렇게 넣기로한 파생 변수는 4가지 입니다.
시간: 월일시분초 입니다.
양산일: 1월2일은 1, 1월 3일은 2... 이렇게 몇 번째 날인지 표시했습니다.
그룹: 하나의 변수에서 정상품이 주로 가지는 범위라면 0으로, 그 외에는 1로 표시.
IQR 외각 여부: 데이터 세트를 사분위수로 나누어 표시된 25% 점과 75%점 사이를 거리로 표현,
		   각 점에서 거리의 1.5배 벗어난 값을 극단값이라고 표시한것.



이제 모델을 만듭니다.
저희가 먼저 만들 모델은 기존에 만들어졌다고 가정했던 모델입니다. 2월 15일 이전 데이터로만 학습을 할 예정입니다.

분류 모델은 두가지를 사용하여 점수가 잘 나온 것으로 챔피언 모델을 선택하기로 했습니다.
평가는 G-mean 점수를 사용했습니다.
라이트GBM과 캣부스트입니다.

타겟변수가 불균형한 데이터이기 때문에 샘플링 기법을 사용합니다.
랜덤언더샘플링, 랜덤오버샘플링, SMOTE, 샘플링 기법은 아니지만 소수클래스에 가중치를 주는 옵션을 모델에서 사용했습니다.

각 모델을 만드는 샘플링 기법, 분류 모델에 대한 평가는, 3월 25일부터 3월 31일까지 생긴 데이터를 정상 불량 예측한 결과로 평가했습니다.

이렇게 샘플링, 분류 모델, 파생변수를 확정지어 기존 모델을 만들었습니다.

(혼동행렬 그림)

저희가 만들어야 할 모델은 3가지 입니다.
1. 2월 15일 이전 데이터를 활용하여 기존에 만들어졌다고 가정했던 모델. 
2. 시스템 도입 후 2월 15일부터 3월 24일 사이에 생긴 데이터로 만들어진 모델.
3. 전체 기간 데이터로 만들어진 모델.
앞서 작업했던 순서대로 나머지 모델도 만들었습니다.
이렇게 3가지 모델을 만들었습니다.

각각 모델을 비교해보겠습니다.
(혼돈행렬, G-mean)

[결말 아직 정해지지 않음!!!!]
분류를 가장 잘 하는 모델은 [전체 기간 데이터로 만들어진 모델]입니다.
이것이 의미하는 바는, "현재 데이터로는 전체 기간의 데이터를 사용하는 것이 좋다"입니다.
(분포가 달라졌지만 정상품과 불량품으로 나눠지는 점은 같다는 그림)
앞서 살펴본대로 시스템 도입 기준으로 분포가 달라졌습니다.
하지만 불량과 정상으로 나누는 기준은 변하지 않은거죠.
분포는 변했지만, 정상과 불량을 구분하는데 있어 시스템 도입 전과 후 데이터 모두 의미있는 것을 알 수 있습니다.
"더 많은 데이터를 학습한 모델이 성능도 좋다"라는 것입니다.

다음은 앞서 결정된 모델의 변수 중요도 입니다.
정상과 불량을 나누는데 ***변수가 가장 중요했다는 것을 확인했습니다.

다음은 변수 값 변화에 따른 불량률입니다.
***변수가 @@보다는 높게 유지해야 양산하기 좋습니다.

요약입니다.